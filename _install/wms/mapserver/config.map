#
# Map file configuration (PEPS)
# Defines quicklook layers (from Sentinel-1 products)
#
MAP
   IMAGETYPE     PNG
   EXTENT	-180 -90 180 90
   SIZE          256 256 
   #
   # PATH TO CONFIGURE !!!!
   # Path to the directory holding the shapefiles or tiles.
   #
   SHAPEPATH     "/data/peps/dhus/data/"
   TRANSPARENT   ON

   #CONFIG "MS_ERRORFILE" "/data/wms/ms_error.txt"
   #DEBUG 5	

   WEB
      IMAGEPATH "/tmp/"
      IMAGEURL "/"
      TEMPLATE "browse.html"
      METADATA
        "ows_enable_request"   	"*"
        "wms_title" 		"WMS PEPS Quicklooks service"
		"wms_srs"		"epsg:4326 epsg:3857"
      END
   END
    
  #
  # Map projection
  #
  # There are two ways to define projections in a Map File. 
  # You can either use inline projection parameters or specify an EPSG code for that projection. 
  # If you use the EPSG code method, Proj.4 looks up the projection parameters in the Proj4 database using the EPSG code as an ID. 
  # This database lookup takes significantly more resources than when the projection parameters are defined inline. 
  # This lookup takes place for each projection definition using EPSG codes in a Map File.
  # (See http://www.mapserver.org/fr/optimization/mapfile.html#mapfile-tuning)
  #   
  PROJECTION
	"proj=longlat"
	"ellps=WGS84"
	"datum=WGS84"
	"no_defs"
  END

  #
  # WMS layer (Product quicklook)
  #
  LAYER
	#DEBUG 5
	NAME "quicklook"
	TYPE RASTER
	
	#
    # Layer projection
    #
    # There are two ways to define projections in a Map File. 
    # You can either use inline projection parameters or specify an EPSG code for that projection. 
    # If you use the EPSG code method, Proj.4 looks up the projection parameters in the Proj4 database using the EPSG code as an ID. 
    # This database lookup takes significantly more resources than when the projection parameters are defined inline. 
    # This lookup takes place for each projection definition using EPSG codes in a Map File.
    # (See http://www.mapserver.org/fr/optimization/mapfile.html#mapfile-tuning)
    #  
    PROJECTION
	  "proj=longlat"
	  "ellps=WGS84"
	  "datum=WGS84"
	  "no_defs"
    END

	DATA "%data%_quicklook.gif"

	STATUS ON
	OPACITY ALPHA
	
	#
	# DEFINES EXTERNAL WORLD FILES LOCATION
	# PROCESSING DIRECTIVES "EXTENT_PRIORITY" AND "WORLDFILE" ALLOWS TO OVERRIDE GDAL OPTION (WORLD FILE LOCATION)
    # (Works from version 6.4 of mapserver. Previous versions contains an issue.
    # https://github.com/mapserver/mapserver/commit/6ecb4fe5ed10ac2285cfdbee012f94614ec2137d
	#
	#PROCESSING "EXTENT_PRIORITY=WORLD"
	#PROCESSING "WORLDFILE=/path/to/worldfiles/"

	VALIDATION
	    #
	    # %data% : YYYY/MM/dd/SSS/PPPPPPPP
	    #
	    # PPPPPPPP : product code 	
	    # SSS : satellite (S1A, S1B)
	    # YYYY/MM/dd : acquisition date
	    #
	    # 'default_data' '/2014/10/23/S1A/S1A_IW_SLC__1SSV_20150331T073046_20150331T073113_PZF4A7_1R05Q2_WYVM'
	    # 'data' '^.*$'
	    'data' '^(20[0-9][0-9])/(0[1-9]|1[012])/(0[1-9]|[1-2][0-9]|3[01])/(S1A|S1B)/(S1A|S1B)_(IW|EW|WV|(S[1-6]))_(SLC|RAW|GRD|OCN)(F|H|M|_)_[0-2](S|A)(SH|SV|DH|DV)_(20[0-9][0-9])(0[1-9]|1[012])(0[1-9]|[1-2][0-9]|3[01])T([01][0-9]|2[0-3])([0-5][0-9])([0-5][0-9])_(20[0-9][0-9])(0[1-9]|1[012])(0[1-9]|[1-2][0-9]|3[01])T([01][0-9]|2[0-3])([0-5][0-9])([0-5][0-9])_([A-Za-z0-9]{6})_([A-Za-z0-9]{6})_([A-Za-z0-9]{4})$'
	END	
  END
END # end of map file
