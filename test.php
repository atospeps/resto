<?php

/*
 * Autoload controllers and modules
 */
function autoload($className) {
    foreach (array(
        'lib/iTag/',
        'lib/JWT/') as $current_dir) {
        $path = $current_dir . sprintf('%s.php', $className);
        if (file_exists($path)) {
            include $path;
            return;
        }
    }
}
spl_autoload_register('autoload');

$config = array(
                    'dbname' => 'itag',
                    /*
                     * Database host - if not specified connect through socket instead of TCP/IP
                     */
                    //'host' => 'localhost',
                    'user' => 'itag',
                    'password' => 'itag'
                );

$wkt = 'POLYGON((20.99977780838230146 36.10011167207419902,20.999780411299799 35.15489003273749802,22.15153663089930092 35.1491625879043994,23.24870999632100066 35.13376350348679722,23.70783214358559832 35.12316211203339833,23.70836832264579996 35.11016547706429947,23.99500342278399856 35.11653116390100138,24.39832834793289962 35.10721816203459866,24.39910722749669958 35.12550563447030072,24.85845478825950039 35.13570697659349662,26.00972076437189884 35.15084307125520269,25.9985234775578995 36.05254067903690185,25.99854803703579975 36.05254100905860071,25.99798476476680165 36.09592226272449977,25.99742868973180165 36.14070199706389985,25.99740333873259956 36.14070165569099657,25.98685579311930027 36.95303660807640256,27.10963188667119894 36.95783048798720216,27.11108600583219896 37.94753713280260143,25.97344729058070101 37.94256984091410345,25.97343994102019948 37.94311117460439675,25.91744898321359969 37.94232533452179723,25.86147092120100055 37.94208091652720327,25.86147906917990014 37.94153978979120012,24.83568554962459984 37.92714264968680027,24.83567015867039984 37.92768043331920325,24.78005781314000089 37.9263619074608016,24.72447176379549916 37.92558175031899736,24.72448793242080001 37.92504438841039871,23.99695740606459893 37.90779520025610339,23.38692510714589901 37.92283326387470055,23.38694215755419847 37.92337349546600223,23.33102170732869851 37.92421135300939738,23.27507346075699957 37.92559054767300353,23.27505719563550102 37.92504987072680223,22.13807393193529904 37.94208532019619895,22.12451514175389988 37.04125361351370316,22.12448554733940043 37.04125404799300014,22.12447804515780092 37.04073286533049725,20.99977508317120112 37.0465830504840028,20.99977780838230146 36.10011167207419902))';

// https://scihub.copernicus.eu/dhus/search?q=S2A_MSIL1C_20170205T105221_N0204_R051_T29NNF_20170205T110645
// $wkt = 'POLYGON ((-9.000180539197991 5.428225419816825,-8.00907051562931 5.427413062105865,-8.010541651301182 4.434241272419837,-9.000180271115845 4.434904339549349,-9.000180539197991 5.428225419816825,-9.000180539197991 5.428225419816825))';

// polygon which wrap dateline
// $wkt = 'POLYGON((149.0625 46.94276208682137,-94.21875 46.94276208682137,-94.21875 -29.046565622728846,149.0625 -29.046565622728846,149.0625 46.94276208682137))';
// $wkt = 'POLYGON((174.0234395 27.931327412293648,-171.2109375 27.931327412293648,-171.2109375 13.51249662703826,174.0234395 13.51249662703826,174.0234395 27.931327412293648))';



$iTag = new iTag($config);
$metadata = array(
        'footprint' => $wkt,
        'timestamp' => isset($properties['startDate']) ? $properties['startDate'] : null
);
$keywords = $iTag->tag($metadata, array(
                    'Political' => array(),
                    'LandCover' => array()
                ));

header('Content-Type: application/json');
print json_encode($keywords);